generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum TypeNotification {
  REALISATION   // Étudiant réalise un acte → notification pour le professeur
  EVALUATION    // Professeur évalue un acte → notification pour l’étudiant
  PAIEMENT      // Étudiant effectue un paiement → notification pour l’admin
  VALIDATION    // Admin valide un paiement → notification pour l’étudiant
}

model ADMINISTRATEUR {
  ID_Admin      Int       @id @default(autoincrement())
  Nom_Admin     String
  Email_Admin   String    @unique
  MotPass_Admin String
  id_Quotas     Int?
  id_Paie       Int?

  user_id       String    @unique

  quotas QUOTAS[]
  paiements PAIEMENT[]

  notifications NOTIFICATION[]  @relation("Notif_Admin")
}

model ETUDIANT {
  ID_Etudiant Int         @id @default(autoincrement())
  user_id     String      @unique 
  FullName_Et String
  Email_Et    String      @unique
  Annee_Et    String
  Dette       Float?
  MotPass_Et  String
  Photo_Et    String?
  
  id_Dep      Int
  departement DEPARTEMENT @relation(fields: [id_Dep], references: [ID_Dep])

  paiements PAIEMENT[]
  sousActes SOUS_ACTES[]

  notifications NOTIFICATION[] @relation("Notif_Etudiant")
}

model DEPARTEMENT {
  ID_Dep    Int        @id @default(autoincrement())
  Nom_Dep   String

  actes     ACTES[]
  etudiants ETUDIANT[]
  quotas    QUOTAS[]

  professeurs PROFESSEURS[] @relation("Prof_Dep")
}

model ACTES {
  ID_Actes    Int          @id @default(autoincrement())
  Desc_Actes  String

  id_Dep      Int
  departement DEPARTEMENT  @relation(fields: [id_Dep], references: [ID_Dep])

  sous_actes SOUS_ACTES[]
}

model SOUS_ACTES {
  ID_SActes     Int           @id @default(autoincrement())
  Desc_SActes   String
  Prix          Float
  Note          Float?
  Date_Realise  DateTime?
  Statut_Valide Boolean

  id_Actes      Int
  acte          ACTES         @relation(fields: [id_Actes], references: [ID_Actes])
  
  id_Etudiant Int?
  etudiant ETUDIANT? @relation(fields: [id_Etudiant], references: [ID_Etudiant])

  id_Prof Int?
  professeur PROFESSEURS? @relation(fields: [id_Prof], references: [ID_Prof])
 
  quotas        QUOTAS[]      @relation("Attribuer")

  notifications  NOTIFICATION[] @relation("Notif_SousActe")
}

model PROFESSEURS {
  ID_Prof      Int         @id @default(autoincrement())
  user_id      String      @unique
  Nom_Prof     String
  Email_Prof   String      @unique
  MotPass_Prof String

  departements DEPARTEMENT[] @relation("Prof_Dep")

  sousActes SOUS_ACTES[]

  notifications NOTIFICATION[]  @relation("Notif_Prof")
}

model QUOTAS {
  ID_Quotas      Int              @id @default(autoincrement())
  Annee          String
  Nombre         Int
  Date_Debut     DateTime
  Date_Fin       DateTime

  id_Dep         Int
  departement    DEPARTEMENT      @relation(fields: [id_Dep], references: [ID_Dep])

  id_Admin       Int
  admin          ADMINISTRATEUR @relation(fields: [id_Admin], references: [ID_Admin])
  
  sous_actes     SOUS_ACTES[]     @relation("Attribuer")
}

model PAIEMENT {
  ID_Paie        Int              @id @default(autoincrement())
  Montant        Float
  Type_Paie      String
  Date_Paie      DateTime
  Statut_Paie    String

  id_Admin Int
  admin ADMINISTRATEUR @relation(fields: [id_Admin], references: [ID_Admin])

  id_Etudiant Int
  etudiant ETUDIANT @relation(fields: [id_Etudiant], references: [ID_Etudiant])

  notifications NOTIFICATION[]  @relation("Notif_Paiement")
}

model NOTIFICATION {
  ID_Notification Int             @id @default(autoincrement())
  Message         String
  Type            TypeNotification
  Date_Envoi      DateTime        @default(now())
  Lu              Boolean         @default(false)

  // Relations facultatives vers un sous-acte ou paiement
  id_SActes       Int?
  sous_acte       SOUS_ACTES?     @relation("Notif_SousActe", fields: [id_SActes], references: [ID_SActes])

  id_Paie         Int?
  paiement        PAIEMENT?       @relation("Notif_Paiement", fields: [id_Paie], references: [ID_Paie])

  // Utilisateur cible (étudiant, prof, admin)
  id_Etudiant     Int?
  etudiant        ETUDIANT?       @relation("Notif_Etudiant", fields: [id_Etudiant], references: [ID_Etudiant])

  id_Prof         Int?
  professeur      PROFESSEURS?    @relation("Notif_Prof", fields: [id_Prof], references: [ID_Prof])

  id_Admin        Int?
  admin           ADMINISTRATEUR? @relation("Notif_Admin", fields: [id_Admin], references: [ID_Admin])
}


