generator client {
  provider      = "prisma-client-js"
  output        = "../generated/prisma"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
  engineType    = "node-api"
}

// datasource db {
//   provider  = "postgresql"
  
// }

model ADMINISTRATEUR {
  ID_Admin      Int            @id @default(autoincrement())
  Nom_Admin     String
  Email_Admin   String         @unique
  MotPass_Admin String
  id_Quotas     Int?
  id_Paie       Int?
  user_id       String         @unique
  notifications NOTIFICATION[] @relation("Notif_Admin")
  paiements     PAIEMENT[]
  quotas        QUOTAS[]
  historique        HISTORIQUE_PAIEMENT[]
}

model ETUDIANT {
  ID_Etudiant   Int            @id @default(autoincrement())
  user_id       String         @unique
  FullName_Et   String
  Email_Et      String         @unique
  Annee_Et      String
  Dette         Float?
  MotPass_Et    String
  Photo_Et      String?
  id_Dep        Int
  departement   DEPARTEMENT    @relation(fields: [id_Dep], references: [ID_Dep])
  notifications NOTIFICATION[] @relation("Notif_Etudiant")
  paiements     PAIEMENT[]
  realisations  REALISATION[]
}

model DEPARTEMENT {
  ID_Dep      Int           @id @default(autoincrement())
  Nom_Dep     String
  actes       ACTES[]
  etudiants   ETUDIANT[]
  quotas      QUOTAS[]
  professeurs PROFESSEURS[] @relation("Prof_Dep")
}

model ACTES {
  ID_Actes    Int          @id @default(autoincrement())
  Desc_Actes  String
  id_Dep      Int
  departement DEPARTEMENT  @relation(fields: [id_Dep], references: [ID_Dep])
  sous_actes  SOUS_ACTES[]
}

model SOUS_ACTES {
  ID_SActes     Int            @id @default(autoincrement())
  Desc_SActes   String
  Prix          Float
  id_Actes      Int
  notifications NOTIFICATION[] @relation("Notif_SousActe")
  realisations  REALISATION[]
  acte          ACTES          @relation(fields: [id_Actes], references: [ID_Actes])
  quotas        QUOTAS[]       @relation("Attribuer")
}

model PROFESSEURS {
  ID_Prof       Int            @id @default(autoincrement())
  user_id       String         @unique
  Nom_Prof      String
  Email_Prof    String         @unique
  MotPass_Prof  String
  notifications NOTIFICATION[] @relation("Notif_Prof")
  realisations  REALISATION[]
  departements  DEPARTEMENT[]  @relation("Prof_Dep")
}

model QUOTAS {
  ID_Quotas   Int            @id @default(autoincrement())
  Annee       String
  Nombre      Int
  Date_Debut  DateTime
  Date_Fin    DateTime
  id_Dep      Int
  id_Admin    Int
  admin       ADMINISTRATEUR @relation(fields: [id_Admin], references: [ID_Admin])
  departement DEPARTEMENT    @relation(fields: [id_Dep], references: [ID_Dep])
  sous_actes  SOUS_ACTES[]   @relation("Attribuer")
}

model PAIEMENT {
  ID_Paie           Int            @id @default(autoincrement())
  Montant           Float
  Montant_Restant   Float?
  Date_Paie         DateTime
  Statut_Paie       StatutPaiement
  id_Admin          Int?
  id_Etudiant       Int
  notifications     NOTIFICATION[] @relation("Notif_Paiement")
  admin             ADMINISTRATEUR? @relation(fields: [id_Admin], references: [ID_Admin])
  etudiant          ETUDIANT       @relation(fields: [id_Etudiant], references: [ID_Etudiant])
  realisations      REALISATION[]
  historique        HISTORIQUE_PAIEMENT[]
}

model NOTIFICATION {
  ID_Notification Int              @id @default(autoincrement())
  Message         String
  Type            TypeNotification
  Date_Envoi      DateTime         @default(now())
  Lu              Boolean          @default(false)
  id_SActes       Int?
  id_Paie         Int?
  id_Etudiant     Int?
  id_Prof         Int?
  id_Admin        Int?
  id_Realisation  Int?
  admin           ADMINISTRATEUR?  @relation("Notif_Admin", fields: [id_Admin], references: [ID_Admin])
  etudiant        ETUDIANT?        @relation("Notif_Etudiant", fields: [id_Etudiant], references: [ID_Etudiant])
  paiement        PAIEMENT?        @relation("Notif_Paiement", fields: [id_Paie], references: [ID_Paie])
  professeur      PROFESSEURS?     @relation("Notif_Prof", fields: [id_Prof], references: [ID_Prof])
  realisation     REALISATION?     @relation("Notif_Realisation", fields: [id_Realisation], references: [ID_Realisation])
  sous_acte       SOUS_ACTES?      @relation("Notif_SousActe", fields: [id_SActes], references: [ID_SActes])
}

model REALISATION {
  ID_Realisation Int            @id @default(autoincrement())
  Date_Realise   DateTime
  Note           Float?
  Statut_Valide  Boolean        @default(false)
  id_SActes      Int
  id_Etudiant    Int
  id_Prof        Int?
  id_Paie        Int?
  notifications  NOTIFICATION[] @relation("Notif_Realisation")
  etudiant       ETUDIANT       @relation(fields: [id_Etudiant], references: [ID_Etudiant])
  paiement       PAIEMENT?      @relation(fields: [id_Paie], references: [ID_Paie])
  professeur     PROFESSEURS?   @relation(fields: [id_Prof], references: [ID_Prof])
  sousActe       SOUS_ACTES     @relation(fields: [id_SActes], references: [ID_SActes])
}

model HISTORIQUE_PAIEMENT {
  ID_Hist      Int            @id @default(autoincrement())
  Action       String         // "VALIDATION", "ANNULATION"
  AncienStatut StatutPaiement
  NouveauStatut StatutPaiement
  Montant      Float?
  Montant_Restant Float?
  Date_Action  DateTime       @default(now())

  id_Paie      Int
  paiement     PAIEMENT       @relation(fields: [id_Paie], references: [ID_Paie])

  id_Admin     Int?
  admin        ADMINISTRATEUR? @relation(fields: [id_Admin], references: [ID_Admin])
}


enum TypeNotification {
  REALISATION
  EVALUATION
  PAIEMENT
  VALIDATION
}

enum StatutPaiement {
  EN_ATTENTE
  PARTIEL
  TOTAL
  ANNULE
}

